#!/usr/bin/python -u
#team dan_and_will

import re
import sys

from http import http

csrf_regex = re.compile(r"name='csrfmiddlewaretoken' value='[0-9a-f]{32}'")

class webcrawler:

    def __init__(self, uname, pwd):
        self.uname = uname
        self.pwd = pwd
        self.http = http('fring.ccs.neu.edu')

    def login(self):
        login_page = self.http.get('/fakebook/')
        # print repr(login_page)
        print login_page
        csrf_token = csrf_regex.findall(login_page)[0][-33:-1]
        form_data = "username={uname}&password={pwd}&csrfmiddlewaretoken={csrf}&next=%2Ffakebook%2F".format(uname=self.uname, pwd=self.pwd, csrf=csrf_token)
        p = self.http.post("/accounts/login/", form_data)

    def crawl(self):
        pass

    def run(self):
        self.login()
        self.crawl()

if __name__ == '__main__':
    wc = webcrawler(sys.argv[1], sys.argv[2])
    wc.run()
